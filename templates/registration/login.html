{% extends "base_site.html" %}

{% block stylesheet %}base{% endblock %}
{% block bodyclass %}login{% endblock %}
{% block usertools %}{% endblock %}
{% block breadcrumbs %}{% endblock %}

{% block extrastyle %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/login.css"/>
{% endblock %}

{% block extrahead %}
<script src="{{ MEDIA_URL }}js/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
        $(document).ready(function() {
                        $("p.saml-switch a").click(
                      function() {
                        $("#regular_login_fields").addClass("hidden");
                        $("#saml_login_fields").removeClass("hidden");
                                $("p.saml-switch").toggle();
                                $("p.regular-switch").toggle();
                      });
                        $("p.regular-switch a").click(
                        function() {
                                        $("p.regular-switch").toggle();
                                        $("p.saml-switch").toggle();
                          $("#saml_login_fields").addClass("hidden");
                          $("#regular_login_fields").removeClass("hidden");
                        });
                });

</script>
{% endblock %}

{% block content %}
<h1>Login to Karaage</h1>
{% if form.errors or form.non_field_errors%}
{{ form.errors }}
{{ form.non_field_errors }}
{% endif %}

{% if samlform.errors %}
{{ samlform.non_field_errors }}
{% endif %}

{% if saml_enabled %}
<p class="saml-switch"><a href="#">Or log in using SAML</a>.</p>
{% endif %}
<p class="regular-switch" style="display: none">Or log in with your <a href="#">{{ org_name }} username/password</a>.</p>

<div id="regular_login_fields">
  {% if request.META.HTTP_PERSISTENT_ID %}
  <ul class="errorlist">
    <li>Please log in using your {{ org_name }} username/password to link your account with your SAML identity.</li>
  </ul>
  {% else %}
  {% if request.META.HTTP_SHIB_SESSION_ID %}
  <ul class="errorlist">
    <li>Your SAML Identity provider is not releasing eduPersonTargetedID. This is needed to log you in via SAML SSO.</li>
  </ul>
  {% endif %}
  {% endif %}
  
  <form method="post" action=".">{% csrf_token %}
    <table>
      <tr><td><label for="id_username">Username:</label></td><td>{{ form.username }}</td></tr>
      <tr><td><label for="id_password">Password:</label></td><td>{{ form.password }}</td></tr>
    </table>
    <input type="submit" value="login" />
    {% if next %}
    <input type="hidden" name="next" value="{{ next }}" />
    {% endif %}
  </form>
</div>
<div id="saml_login_fields" class="hidden">
  
  <form method="post" action="{% url kg_saml_login %}">{% csrf_token %}
    <table class="float-left">
      <tr><td><label for="id_institute">Institute:</label></td><td>{{ samlform.institute }}</td></tr>
    </table>
    
    <input type="submit" value="SAML login"/>
    {% if next %}
    <input type="hidden" name="next" value="{{ next }}" />
    {% endif %}
  </form>
  
</div>

{% endblock %}


